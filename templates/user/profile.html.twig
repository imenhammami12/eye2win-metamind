{% extends 'base.html.twig' %}

{% block title %}My Profile - EyeTwin{% endblock %}

{% block body %}
<!-- Breadcrumb -->


<section class="profile_section section_padding">
    <div class="container">
        <div class="row">
            <!-- Profile Card -->
            <div class="col-lg-4">
                <div class="profile_card">
                    <div class="profile_header">
                        {% if user.profilePicture %}
                            <img src="{{ asset('uploads/profiles/' ~ user.profilePicture) }}" 
                                 alt="{{ user.username }}" 
                                 class="profile_image">
                        {% else %}
                            <div class="profile_image_placeholder">
                                {{ user.username|slice(0, 1)|upper }}
                            </div>
                        {% endif %}
                    </div>
                    
                    <div class="profile_info">
                        <h2 class="profile_username">{{ user.username }}</h2>
                        <p class="profile_email">{{ user.email }}</p>
                        
                        <div class="profile_status">
                            {% if user.accountStatus.value == 'active' %}
                                <span class="status_badge status_active">
                                    <i class="fas fa-check-circle"></i>
                                </span>
                            {% elseif user.accountStatus.value == 'suspended' %}
                                <span class="status_badge status_suspended">
                                    <i class="fas fa-pause-circle"></i>
                                </span>
                            {% elseif user.accountStatus.value == 'banned' %}
                                <span class="status_badge status_banned">
                                    <i class="fas fa-ban"></i>
                                </span>
                            {% endif %}
                            
                            {% if is_granted('ROLE_COACH') %}
                                <span class="status_badge status_coach">
                                    <i class="fas fa-graduation-cap"></i>
                                </span>
                            {% endif %}
                            
                            {% if is_granted('ROLE_ADMIN') %}
                                <span class="status_badge status_admin">
                                    <i class="fas fa-shield-alt"></i>
                                </span>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="profile_actions">
                        {% if not is_granted('ROLE_ADMIN') and not is_granted('ROLE_COACH') and not latestCoachApplication %}
                            <a href="{{ path('user_apply_coach') }}" class="btn_profile btn_apply">
                                APPLY TO BE A COACH
                            </a>
                        {% endif %}
                        <a href="{{ path('user_edit_profile') }}" class="btn_profile btn_edit">
                            EDIT PROFILE
                        </a>
                    </div>
                </div>
                
                <!-- About Me Section -->
                {% if user.bio %}
                <div class="profile_card mt-4">
                    <h4 class="card_title">ABOUT ME</h4>
                    <p class="card_text">{{ user.bio }}</p>
                </div>
                {% endif %}
            </div>
            
            <!-- Game Statistics -->
            <div class="col-lg-8">
                <div class="game_statistics">
                    <h3 class="statistics_title">GAME STATISTICS</h3>
                    
                    <div class="statistics_grid">
                        <div class="stat_item">
                            <div class="stat_icon">
                                <i class="fas fa-gamepad"></i>
                            </div>
                            <div class="stat_info">
                                <p class="stat_label">Games Played</p>
                                <h4 class="stat_value">{{ stats.teams_count ?? 0 }}</h4>
                            </div>
                        </div>
                        
                        <div class="stat_item">
                            <div class="stat_icon">
                                <i class="fas fa-trophy"></i>
                            </div>
                            <div class="stat_info">
                                <p class="stat_label">Wins</p>
                                <h4 class="stat_value">{{ stats.owned_teams_count ?? 0 }}</h4>
                            </div>
                        </div>
                        
                        <div class="stat_item">
                            <div class="stat_icon">
                                <i class="fas fa-percent"></i>
                            </div>
                            <div class="stat_info">
                                <p class="stat_label">Win Rate</p>
                                <h4 class="stat_value">0%</h4>
                            </div>
                        </div>
                        
                        <div class="stat_item">
                            <div class="stat_icon">
                                <i class="fas fa-star"></i>
                            </div>
                            <div class="stat_info">
                                <p class="stat_label">Favorite Hero/Character</p>
                                <h4 class="stat_value">None</h4>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Account Info -->
                <div class="profile_card mt-4">
                    <h4 class="card_title"><i class="fas fa-info-circle"></i> Account Information</h4>
                    <div class="account_info">
                        <div class="info_row">
                            <span class="info_label">Member since</span>
                            <span class="info_value">{{ user.createdAt|date('m/d/Y') }}</span>
                        </div>
                        
                        {% if user.lastLogin %}
                        <div class="info_row">
                            <span class="info_label">Last login</span>
                            <span class="info_value">{{ user.lastLogin|date('m/d/Y at h:i A') }}</span>
                        </div>
                        {% endif %}
                        
                        <div class="info_row">
                            <span class="info_label">Teams</span>
                            <span class="info_value">{{ user.teamMemberships|length }} team(s) joined</span>
                        </div>
                        
                        <div class="info_row">
                            <span class="info_label">Teams created</span>
                            <span class="info_value">{{ user.ownedTeams|length }} team(s)</span>
                        </div>
                    </div>
                </div>
                
                <!-- My Teams -->
                {% if user.teamMemberships|length > 0 %}
                <div class="profile_card mt-4">
                    <h4 class="card_title"><i class="fas fa-users"></i> My Teams</h4>
                    <div class="teams_list">
                        {% for membership in user.teamMemberships %}
                        <a href="{{ path('team_show', {id: membership.team.id}) }}" class="team_item">
                            <div class="team_header">
                                <h5 class="team_name">{{ membership.team.name }}</h5>
                                {% if membership.role.value == 'owner' %}
                                    <span class="team_badge badge_owner">Owner</span>
                                {% elseif membership.role.value == 'co_captain' %}
                                    <span class="team_badge badge_captain">Co-Captain</span>
                                {% else %}
                                    <span class="team_badge badge_member">Member</span>
                                {% endif %}
                            </div>
                            <p class="team_description">
                                {{ membership.team.description|length > 100 ? membership.team.description|slice(0, 100) ~ '...' : membership.team.description }}
                            </p>
                            <small class="team_date">Member since {{ membership.joinedAt|date('m/d/Y') }}</small>
                        </a>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}
                
                <!-- Coach Application Status -->
                {% if latestCoachApplication %}
                <div class="profile_card mt-4">
                    <h4 class="card_title"><i class="fas fa-graduation-cap"></i> Coach Application</h4>
                    <div class="coach_application">
                        {% if latestCoachApplication.status.value == 'pending' %}
                            <div class="application_status status_pending">
                                <strong>Status:</strong> Pending review
                            </div>
                        {% elseif latestCoachApplication.status.value == 'approved' %}
                            <div class="application_status status_approved">
                                <strong>Status:</strong> Approved ✅
                            </div>
                        {% elseif latestCoachApplication.status.value == 'rejected' %}
                            <div class="application_status status_rejected">
                                <strong>Status:</strong> Rejected ❌
                            </div>
                        {% endif %}
                        
                        <p><strong>Submission date:</strong> {{ latestCoachApplication.submittedAt|date('m/d/Y at h:i A') }}</p>
                        
                        {% if latestCoachApplication.reviewedAt %}
                            <p><strong>Review date:</strong> {{ latestCoachApplication.reviewedAt|date('m/d/Y at h:i A') }}</p>
                        {% endif %}
                        
                        {% if latestCoachApplication.reviewComment %}
                            <hr>
                            <p><strong>Administrator's comment:</strong></p>
                            <p class="mb-0">{{ latestCoachApplication.reviewComment }}</p>
                        {% endif %}
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</section>
{% endblock %}