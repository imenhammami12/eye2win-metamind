{# templates/user/profile.html.twig #}
{% extends 'base.html.twig' %}

{% block title %}My Profile - EyeTwin{% endblock %}

{% block body %}
<section class="profile_section section_padding">
    <div class="container">
        <div class="row">
            <!-- Profile Card -->
            <div class="col-lg-4">
                <div class="profile_card">
                    <div class="profile_header">
                        {% if user.profilePicture %}
                            <img src="{{ asset('uploads/profiles/' ~ user.profilePicture) }}" 
                                 alt="{{ user.username }}" 
                                 class="profile_image">
                        {% else %}
                            <div class="profile_image_placeholder">
                                {{ user.username|slice(0, 1)|upper }}
                            </div>
                        {% endif %}
                    </div>
                    
                    <div class="profile_info">
                        <h2 class="profile_username">{{ user.username }}</h2>
                        <p class="profile_email">{{ user.email }}</p>
                        
                        <div class="profile_status">
                            {% if user.accountStatus.value == 'ACTIVE' %}
                                <span class="status_badge status_active">
                                    <i class="fas fa-check-circle"></i> Active
                                </span>
                            {% elseif user.accountStatus.value == 'SUSPENDED' %}
                                <span class="status_badge status_suspended">
                                    <i class="fas fa-pause-circle"></i> Suspended
                                </span>
                            {% elseif user.accountStatus.value == 'BANNED' %}
                                <span class="status_badge status_banned">
                                    <i class="fas fa-ban"></i> Banned
                                </span>
                            {% endif %}
                            
                            {% if is_granted('ROLE_COACH') %}
                                <span class="status_badge status_coach">
                                    <i class="fas fa-graduation-cap"></i> Coach
                                </span>
                            {% endif %}
                            
                            {% if is_granted('ROLE_ADMIN') %}
                                <span class="status_badge status_admin">
                                    <i class="fas fa-shield-alt"></i> Admin
                                </span>
                            {% endif %}
                        </div>
                    </div>

                    <div class="profile_actions">
                        {% if not is_granted('ROLE_ADMIN') and not is_granted('ROLE_COACH') and not hasPendingApplication %}
                            <a href="{{ path('user_apply_coach') }}" class="btn_profile btn_apply">
                                <i class="fas fa-graduation-cap"></i> APPLY TO BE A COACH
                            </a>
                        {% endif %}

                        <a href="{{ path('user_edit_profile') }}" class="btn_profile btn_edit">
                            <i class="fas fa-edit"></i> EDIT PROFILE
                        </a>
                    </div>
                </div>
                
                {% if user.bio %}
                <div class="profile_card mt-4">
                    <h4 class="card_title"><i class="fas fa-user"></i> ABOUT ME</h4>
                    <p class="card_text">{{ user.bio }}</p>
                </div>
                {% endif %}
            </div>
            
            <!-- Right Column -->
            <div class="col-lg-8">

                {% if is_granted('ROLE_COACH') and latestCoachApplication and latestCoachApplication.status.value == 'APPROVED' %}
                <div class="profile_card mb-4" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                    <div class="text-center py-4">
                        <i class="fas fa-graduation-cap" style="font-size: 48px; margin-bottom: 15px;"></i>
                        <h3 class="mb-2">ðŸŽ‰ Congratulations!</h3>
                        <h4 class="mb-3">You are now a certified Coach</h4>
                        <p class="mb-0">You can now create live streams and help other players improve their skills.</p>
                        {% if latestCoachApplication.reviewedAt %}
                            <small class="d-block mt-3" style="opacity: 0.9;">
                                Approved on {{ latestCoachApplication.reviewedAt|date('F d, Y') }}
                            </small>
                        {% endif %}
                    </div>
                </div>
                {% endif %}

                {# ===== COINS CARD ===== #}
                <div class="profile_card mb-4" style="background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); border: 1px solid #4a4a6a;">
                    <div class="d-flex justify-content-between align-items-center flex-wrap gap-3">
                        <div>
                            <h4 class="card_title mb-1">
                                <i class="fas fa-coins" style="color: #f6d860;"></i> EyeTwin Coins
                            </h4>
                            <p style="color: #a0a0b0; font-size: 13px; margin-bottom: 0;">
                                Use coins to access exclusive coaching live streams
                            </p>
                        </div>
                        <div class="text-end">
                            <div style="font-size: 42px; font-weight: 900; color: #f6d860; line-height: 1;">
                                {{ app.user.coinBalance }}
                            </div>
                            <small style="color: #888; font-size: 12px;">coins available</small>
                            <br>
                            <a href="{{ path('coins_index') }}" style="
                                display: inline-block;
                                margin-top: 8px;
                                background: linear-gradient(90deg, #f6d860, #f6ad55);
                                color: #1a1a2e;
                                padding: 8px 20px;
                                border-radius: 20px;
                                font-size: 13px;
                                font-weight: bold;
                                text-decoration: none;">
                                <i class="fas fa-plus"></i> Buy More Coins
                            </a>
                        </div>
                    </div>
                </div>

                {# ===== GAME STATISTICS ===== #}
                <div class="game_statistics">
                    <h3 class="statistics_title">GAME STATISTICS</h3>
                    <div class="statistics_grid">
                        <div class="stat_item">
                            <div class="stat_icon"><i class="fas fa-users"></i></div>
                            <div class="stat_info">
                                <p class="stat_label">Teams Joined</p>
                                <h4 class="stat_value">{{ stats.teams_count }}</h4>
                            </div>
                        </div>
                        <div class="stat_item">
                            <div class="stat_icon"><i class="fas fa-crown"></i></div>
                            <div class="stat_info">
                                <p class="stat_label">Teams Owned</p>
                                <h4 class="stat_value">{{ stats.owned_teams_count }}</h4>
                            </div>
                        </div>
                        <div class="stat_item">
                            <div class="stat_icon"><i class="fas fa-trophy"></i></div>
                            <div class="stat_info">
                                <p class="stat_label">Achievements</p>
                                <h4 class="stat_value">0</h4>
                            </div>
                        </div>
                        <div class="stat_item">
                            <div class="stat_icon"><i class="fas fa-star"></i></div>
                            <div class="stat_info">
                                <p class="stat_label">Rating</p>
                                <h4 class="stat_value">N/A</h4>
                            </div>
                        </div>
                    </div>
                </div>

                {# ===== ACCOUNT INFO ===== #}
                <div class="profile_card mt-4">
                    <h4 class="card_title"><i class="fas fa-info-circle"></i> Account Information</h4>
                    <div class="account_info">
                        <div class="info_row">
                            <span class="info_label">Member since</span>
                            <span class="info_value">{{ user.createdAt|date('m/d/Y') }}</span>
                        </div>
                        {% if user.lastLogin %}
                        <div class="info_row">
                            <span class="info_label">Last login</span>
                            <span class="info_value">{{ user.lastLogin|date('m/d/Y at h:i A') }}</span>
                        </div>
                        {% endif %}
                        <div class="info_row">
                            <span class="info_label">Teams</span>
                            <span class="info_value">{{ user.teamMemberships|length }} team(s) joined</span>
                        </div>
                        <div class="info_row">
                            <span class="info_label">Teams created</span>
                            <span class="info_value">{{ user.ownedTeams|length }} team(s)</span>
                        </div>
                        <div class="info_row">
                            <span class="info_label">EyeTwin Coins</span>
                            <span class="info_value" style="color: #f6d860; font-weight: bold;">
                                <i class="fas fa-coins"></i> {{ app.user.coinBalance }}
                            </span>
                        </div>
                    </div>
                </div>

                {# ===== COACH APPLICATION ===== #}
                {% if latestCoachApplication and not is_granted('ROLE_COACH') %}
                <div class="profile_card mt-4">
                    <h4 class="card_title"><i class="fas fa-graduation-cap"></i> Coach Application Status</h4>
                    <div class="coach_application">
                        {% if latestCoachApplication.status.value == 'PENDING' %}
                            <div class="alert alert-warning">
                                <strong><i class="fas fa-clock"></i> Status:</strong> Pending Review
                                <p class="mb-0 mt-2">Your application is currently being reviewed by our team.</p>
                            </div>
                        {% elseif latestCoachApplication.status.value == 'REJECTED' %}
                            <div class="alert alert-danger">
                                <strong><i class="fas fa-times-circle"></i> Status:</strong> Rejected
                                <p class="mb-0 mt-2">Unfortunately, your application was not approved.</p>
                            </div>
                        {% endif %}
                        <hr>
                        <p><strong>Submission date:</strong> {{ latestCoachApplication.submittedAt|date('m/d/Y at h:i A') }}</p>
                        {% if latestCoachApplication.reviewedAt %}
                            <p><strong>Review date:</strong> {{ latestCoachApplication.reviewedAt|date('m/d/Y at h:i A') }}</p>
                        {% endif %}
                        {% if latestCoachApplication.reviewComment %}
                            <hr>
                            <p><strong>Administrator's comment:</strong></p>
                            <div class="alert alert-info">{{ latestCoachApplication.reviewComment }}</div>
                        {% endif %}
                        {% if latestCoachApplication.status.value == 'REJECTED' %}
                            <hr>
                            <a href="{{ path('user_apply_coach') }}" class="btn btn-primary">
                                <i class="fas fa-redo"></i> Submit New Application
                            </a>
                        {% endif %}
                    </div>
                </div>
                {% endif %}

            </div>
        </div>
    </div>
</section>
{% endblock %}
