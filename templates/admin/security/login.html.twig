<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Login - EyeTwin</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:'Inter',sans-serif;background:linear-gradient(135deg,#1a0e2e 0%,#2d1b3d 50%,#1a0e2e 100%);color:#fff;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px}
        .box{background:rgba(20,10,35,.95);backdrop-filter:blur(20px);border-radius:20px;border:1px solid rgba(255,255,255,.1);box-shadow:0 20px 60px rgba(0,0,0,.5);max-width:460px;width:100%}
        .hdr{background:linear-gradient(135deg,rgba(255,60,100,.15),rgba(120,40,200,.15));padding:48px 40px;text-align:center;border-bottom:1px solid rgba(255,255,255,.08)}
        .logo{width:140px;height:80px;margin:0 auto 20px;background:rgba(255,255,255,.05);border-radius:16px;display:flex;align-items:center;justify-content:center;border:1px solid rgba(255,255,255,.1)}
        .logo img{max-width:100%;max-height:100%;object-fit:contain}
        .hdr h1{font-size:32px;font-weight:700;margin-bottom:8px;background:linear-gradient(135deg,#fff,rgba(255,255,255,.85));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
        .hdr p{font-size:13px;color:rgba(255,255,255,.6);text-transform:uppercase;letter-spacing:1.5px}
        .bdy{padding:40px}
        .alert{padding:16px 18px;border-radius:12px;margin-bottom:24px;font-size:13px;display:flex;align-items:center;gap:12px;border:1px solid;background:rgba(255,60,100,.15);border-color:rgba(255,60,100,.3);color:rgba(255,255,255,.85)}
        .alert i{font-size:20px;color:#ff3c64;flex-shrink:0}
        .grp{margin-bottom:24px}
        .lbl{display:block;font-weight:600;margin-bottom:10px;color:rgba(255,255,255,.85);font-size:12px;text-transform:uppercase;letter-spacing:.8px}
        .lbl i{margin-right:6px;color:#ff3c64}
        .wrap{position:relative}
        .inp{width:100%;padding:14px 16px 14px 48px;border:1px solid rgba(255,255,255,.15);border-radius:12px;font-size:14px;background:rgba(255,255,255,.08);color:#fff;font-family:inherit;transition:all .3s}
        .inp::placeholder{color:rgba(255,255,255,.5)}
        .inp:focus{outline:none;border-color:rgba(255,60,100,.5);background:rgba(255,255,255,.12);box-shadow:0 0 0 3px rgba(255,60,100,.15)}
        .inp:-webkit-autofill,.inp:-webkit-autofill:focus{-webkit-text-fill-color:#fff!important;-webkit-box-shadow:0 0 0 1000px rgba(30,15,45,.9) inset!important}
        .ico{position:absolute;left:16px;top:50%;transform:translateY(-50%);color:rgba(255,255,255,.4);font-size:18px;pointer-events:none}
        .chk{display:flex;align-items:center;margin-bottom:28px}
        .chk input{width:20px;height:20px;margin-right:10px;accent-color:#ff3c64}
        .chk label{font-size:13px;color:rgba(255,255,255,.85);cursor:pointer}
        .btn{width:100%;padding:16px;background:linear-gradient(135deg,#ff3c64,#ff1744);color:#fff;border:none;border-radius:12px;font-size:15px;font-weight:700;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:10px;text-transform:uppercase;letter-spacing:.8px;box-shadow:0 6px 20px rgba(255,60,100,.3);transition:all .3s}
        .btn:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 10px 28px rgba(255,60,100,.4)}
        .btn:disabled{opacity:.6;cursor:not-allowed;transform:none}
        .footer{text-align:center;margin-top:28px;padding-top:24px;border-top:1px solid rgba(255,255,255,.08)}
        .footer i{color:#43e97b;font-size:22px;margin-right:8px}
        .footer span{color:rgba(255,255,255,.6);font-size:12px;text-transform:uppercase;letter-spacing:.8px}
        .back{text-align:center;margin-top:24px}
        .back a{color:rgba(255,255,255,.85);text-decoration:none;font-size:13px;display:inline-flex;align-items:center;gap:8px;padding:8px 16px;border-radius:8px;transition:all .3s}
        .back a:hover{color:#fff;background:rgba(255,255,255,.05)}
        @keyframes spin{to{transform:rotate(360deg)}}
        .spin{width:16px;height:16px;border:2px solid rgba(255,255,255,.3);border-top-color:#fff;border-radius:50%;animation:spin .6s linear infinite;display:inline-block}
    </style>
</head>
<body>
<div class="box">
    <div class="hdr">
        <div class="logo"><img src="{{ asset('assets/img/eyetwin-logo.png') }}" alt="EyeTwin"></div>
        <h1>Administration</h1>
        <p>Administrators only</p>
    </div>
    <div class="bdy">
        {% if error %}
        <div class="alert">
            <i class="bi bi-exclamation-triangle-fill"></i>
            <span>{{ error.messageKey|trans(error.messageData, 'security') }}</span>
        </div>
        {% endif %}

        <form method="post" action="{{ path('admin_login') }}" id="loginForm">
            <div class="grp">
                <label class="lbl"><i class="bi bi-person-circle"></i>Email</label>
                <div class="wrap">
                    <input type="text" id="email" name="_username" class="inp"
                           value="{{ last_username }}" required autofocus
                           autocomplete="username" placeholder="Enter your email">
                    <i class="bi bi-person ico"></i>
                </div>
            </div>
            <div class="grp">
                <label class="lbl"><i class="bi bi-key-fill"></i>Password</label>
                <div class="wrap">
                    <input type="password" id="password" name="_password" class="inp"
                           required autocomplete="current-password" placeholder="Enter your password">
                    <i class="bi bi-lock ico"></i>
                </div>
            </div>
            <div class="chk">
                <input type="checkbox" id="rem" name="_remember_me">
                <label for="rem">Remember me</label>
            </div>
            <input type="hidden" name="_csrf_token" value="{{ csrf_token('authenticate') }}">
            <button type="button" id="loginBtn" class="btn">
                <i class="bi bi-shield-check"></i><span>Log in</span>
            </button>
        </form>

        <div class="footer"><i class="bi bi-shield-fill-check"></i><span>Secure SSL connection</span></div>
        <div class="back"><a href="{{ path('app_home') }}"><i class="bi bi-arrow-left"></i>Back to main site</a></div>
    </div>
</div>

<script>
const btn   = document.getElementById('loginBtn');
const form  = document.getElementById('loginForm');
const email = document.getElementById('email');

btn.addEventListener('click', async () => {
    const emailVal = email.value.trim();
    if (!emailVal) { email.focus(); return; }

    btn.disabled = true;
    btn.innerHTML = '<span class="spin"></span><span>Checking…</span>';

    try {
        const res  = await fetch('{{ path("face_pre_check") }}', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email: emailVal })
        });
        const data = await res.json();

        if (data.requiresFace) {
            window.location.href = data.redirect;
        } else {
            form.submit();
        }
    } catch (e) {
        form.submit(); // réseau KO → soumettre quand même
    }
});

// Enter sur password → click button
document.getElementById('password').addEventListener('keydown', e => {
    if (e.key === 'Enter') { e.preventDefault(); btn.click(); }
});
</script>
</body>
</html>
