{% extends 'admin_layout.html.twig' %}

{% block title %}{{ planning.type.value }} - Planning Details{% endblock %}
{% block page_title %}Session Details{% endblock %}

{% block body %}
<div class="mb-3 fade-in">
    <a href="{{ path('admin_planning_index') }}" class="btn btn-outline-secondary">
        <i class="bi bi-arrow-left me-2"></i>Back to List
    </a>
</div>

<div class="row g-4">
    {# Main Profile Card #}
    <div class="col-lg-4">
        <div class="table-card text-center fade-in" style="animation-delay: 0.1s;">
            <div class="mb-4 position-relative">
                {% if planning.image %}
                    <img src="{{ asset('uploads/planning/' ~ planning.image) }}" 
                         alt="{{ planning.type.value }}" 
                         style="width: 150px; height: 150px; border-radius: 50%; object-fit: cover; border: 5px solid rgba(102, 126, 234, 0.3); box-shadow: 0 8px 24px rgba(0,0,0,0.2);"
                         loading="lazy">
                {% else %}
                    <div style="width: 150px; height: 150px; margin: 0 auto; border-radius: 50%; background: linear-gradient(135deg, #FFB75E, #ED8F03); display: flex; align-items: center; justify-content: center; color: white; font-size: 48px; font-weight: bold; box-shadow: 0 8px 24px rgba(0,0,0,0.2);">
                        <i class="bi bi-controller"></i>
                    </div>
                {% endif %}
                
                {# Status indicator #}
                {% if planning.needPartner %}
                     <div style="position: absolute; bottom: 10px; right: calc(50% - 65px); width: 22px; height: 22px; background: #43e97b; border: 3px solid var(--dark-bg); border-radius: 50%; box-shadow: 0 0 12px rgba(67, 233, 123, 0.6);"
                          title="Looking for Partner" data-bs-toggle="tooltip"></div>
                {% else %}
                     <div style="position: absolute; bottom: 10px; right: calc(50% - 65px); width: 22px; height: 22px; background: #fa709a; border: 3px solid var(--dark-bg); border-radius: 50%; box-shadow: 0 0 12px rgba(250, 112, 154, 0.6);"
                          title="Closed / Full" data-bs-toggle="tooltip"></div>
                {% endif %}
            </div>
            
            <h4 class="mb-1">{{ planning.type.value }}</h4>
            <p class="text-muted mb-3">{{ planning.level.value }}</p>
            
            <div class="mb-3 d-flex gap-2 justify-content-center flex-wrap">
                {% if planning.needPartner %}
                    <span class="badge bg-success">
                        <i class="bi bi-people-fill me-1"></i>Partners Needed
                    </span>
                {% else %}
                    <span class="badge bg-secondary">
                        <i class="bi bi-slash-circle me-1"></i>Closed
                    </span>
                {% endif %}
                
                <span class="badge {{ planning.localisation == 'Online' ? 'bg-info' : 'bg-warning' }}">
                    <i class="bi bi-{{ planning.localisation == 'Online' ? 'wifi' : 'geo-alt-fill' }} me-1"></i>
                    {{ planning.localisation }}
                </span>
            </div>
            
            <hr>
            
            {# Actions #}
            <div class="d-grid gap-2">
                <a href="{{ path('admin_planning_edit', {id: planning.id}) }}" class="btn btn-warning text-white">
                    <i class="bi bi-pencil me-2"></i>Edit Session
                </a>
                
                <button type="button" 
                        class="btn btn-danger"
                        onclick="openDeleteModal('{{ path('admin_planning_delete', {id: planning.id}) }}', '{{ csrf_token('delete-' ~ planning.id) }}')">
                    <i class="bi bi-trash me-2"></i>Delete Session
                </button>
            </div>
        </div>
    </div>
    
    {# Detailed Information #}
    <div class="col-lg-8">
        <div class="table-card mb-4 fade-in" style="animation-delay: 0.3s;">
            <div class="table-header">
                <h5><i class="bi bi-info-circle me-2"></i>Session Information</h5>
            </div>
            
            <table class="table table-borderless">
                <tbody>
                    <tr>
                        <th style="width: 200px;"><i class="bi bi-file-text me-2"></i>Description</th>
                        <td>
                            <p class="mb-0 text-muted" style="line-height: 1.6;">{{ planning.description }}</p>
                        </td>
                    </tr>
                    <tr>
                        <th><i class="bi bi-calendar3 me-2"></i>Date</th>
                        <td>{{ planning.date|date('l, F d, Y') }}</td>
                    </tr>
                    <tr>
                        <th><i class="bi bi-clock me-2"></i>Time</th>
                        <td>{{ planning.time|date('H:i') }}</td>
                    </tr>
                    <tr>
                        <th><i class="bi bi-geo me-2"></i>Location</th>
                        <td>
                            {{ planning.localisation }}
                            {% if planning.localisation == 'Online' %}
                                <span class="text-muted ms-2">(Remote)</span>
                            {% endif %}
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Modal Container Block -->
{% endblock %}

{% block modal_container %}
<div class="modal fade" id="deleteModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-hidden="true" style="z-index: 1060;">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-0 shadow-lg" style="border-radius: 16px; overflow: hidden;">
            <div class="modal-header bg-danger text-white border-0">
                <h5 class="modal-title fw-bold">
                    <i class="bi bi-exclamation-triangle-fill me-2"></i>Confirmation
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body p-4 text-center">
                <div class="mb-3">
                    <i class="bi bi-trash text-danger" style="font-size: 4rem; opacity: 0.2;"></i>
                </div>
                <h5 class="mb-3">Are you sure you want to delete this session?</h5>
                <p class="text-muted mb-0">This action cannot be undone.</p>
            </div>
            <div class="modal-footer border-0 bg-light justify-content-center p-3">
                <button type="button" class="btn btn-outline-secondary px-4" data-bs-dismiss="modal">Cancel</button>
                <form method="post" id="deleteForm">
                    <input type="hidden" name="_token" id="deleteToken">
                    <button type="submit" class="btn btn-danger px-4">
                        <i class="bi bi-trash me-2"></i>Delete Permanently
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>
<button id="deleteModalTrigger" class="d-none" data-bs-toggle="modal" data-bs-target="#deleteModal"></button>
{% endblock %}

{% block javascripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Tooltips
    const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
    tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl);
    });
});

function openDeleteModal(actionUrl, csrfToken) {
    const form = document.getElementById('deleteForm');
    const tokenInput = document.getElementById('deleteToken');
    
    form.action = actionUrl;
    tokenInput.value = csrfToken;
    
    document.getElementById('deleteModalTrigger').click();
}
</script>
{% endblock %}
