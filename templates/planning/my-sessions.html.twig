{% extends 'base.html.twig' %}

{% block title %}My Sessions - EyeTwin{% endblock %}

{% block body %}
    <!-- breadcrumb -->
    <section class="breadcrumb breadcrumb_bg" style="background: #0f172a;">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="breadcrumb_iner text-center">
                        <div class="breadcrumb_iner_item">
                            <h2 style="font-weight: 800; color: #fff;">My Sessions</h2>
                            <p style="color: #94a3b8;">
                                <a href="{{ path('app_home') }}" style="color: #cbd5e1;">Home</a> 
                                <span style="color: #64748b;">-</span> 
                                My Sessions
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- My Sessions List -->
    <section class="section_padding" style="background: #0b1120; min-height: 70vh;">
        <div class="container">
            <div class="row justify-content-center">
                {% for session in sessions %}
                    <div class="col-lg-8 mb-4">
                        <div class="session-card">
                            <div class="row g-0">
                                <div class="col-md-4">
                                    {% if session.planning.image %}
                                        <img src="{{ asset('uploads/planning/' ~ session.planning.image) }}" alt="Session" class="session-image">
                                    {% else %}
                                        <img src="https://via.placeholder.com/300x200?text=Session" alt="Session" class="session-image">
                                    {% endif %}
                                </div>
                                <div class="col-md-8">
                                    <div class="session-content">
                                        <div class="d-flex justify-content-between align-items-start mb-2">
                                            <span class="badge-type">{{ session.planning.type.value }}</span>
                                            {% if session.status == 'en attente' %}
                                                <span class="badge-status pending">
                                                    <i class="bi bi-hourglass-split me-1"></i>Pending
                                                </span>
                                            {% elseif session.status == 'confirmé' %}
                                                <span class="badge-status confirmed">
                                                    <i class="bi bi-check-circle me-1"></i>Confirmed
                                                </span>
                                            {% elseif session.status == 'annulé' %}
                                                <span class="badge-status cancelled">
                                                    <i class="bi bi-x-circle me-1"></i>Cancelled
                                                </span>
                                            {% endif %}
                                        </div>
                                        
                                        <h4 class="session-title">{{ session.planning.description }}</h4>
                                        
                                        <div class="session-details">
                                            <div class="detail-item">
                                                <i class="bi bi-signal"></i>
                                                <span>{{ session.planning.level.value }}</span>
                                            </div>
                                            <div class="detail-item">
                                                <i class="bi bi-calendar3"></i>
                                                <span>{{ session.planning.date|date('M d, Y') }}</span>
                                            </div>
                                            <div class="detail-item">
                                                <i class="bi bi-clock"></i>
                                                <span>{{ session.planning.time|date('H:i') }}</span>
                                            </div>
                                            <div class="detail-item">
                                                <i class="bi bi-geo-alt"></i>
                                                <span>{{ session.planning.localisation }}</span>
                                            </div>
                                        </div>

                                        <div class="session-meta">
                                            <small class="text-muted">
                                                <i class="bi bi-clock-history me-1"></i>
                                                Joined on {{ session.joinedAt|date('M d, Y - H:i') }}
                                            </small>
                                        </div>

                                        <div class="session-actions">
                                            <button type="button" 
                                                    class="btn-cancel-session" 
                                                    data-toggle="modal" 
                                                    data-target="#cancelModal{{ session.id }}">
                                                <i class="bi bi-x-circle me-2"></i>Cancel Registration
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Cancel Confirmation Modal -->
                        <div class="modal fade" id="cancelModal{{ session.id }}" tabindex="-1" role="dialog" aria-hidden="true">
                            <div class="modal-dialog modal-dialog-centered" role="document">
                                <div class="modal-content" style="background: #1e293b; border: 1px solid rgba(255,255,255,0.1); border-radius: 16px;">
                                    <div class="modal-header border-0" style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); border-radius: 16px 16px 0 0;">
                                        <h5 class="modal-title text-white fw-bold">
                                            <i class="bi bi-exclamation-triangle-fill me-2"></i>Cancel Registration
                                        </h5>
                                        <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                                            <span aria-hidden="true">&times;</span>
                                        </button>
                                    </div>
                                    <div class="modal-body p-4 text-center">
                                        <div class="mb-3">
                                            <i class="bi bi-x-circle text-danger" style="font-size: 4rem;"></i>
                                        </div>
                                        <h5 class="text-white mb-3">Are you sure you want to cancel this registration?</h5>
                                        <p class="text-muted mb-0">
                                            <strong class="text-warning">Warning:</strong> If you cancel your registration, it cannot be restored. 
                                            You will need to register again if you change your mind.
                                        </p>
                                    </div>
                                    <div class="modal-footer border-0 justify-content-center pb-4">
                                        <button type="button" class="btn btn-secondary px-4" data-dismiss="modal">
                                            <i class="bi bi-arrow-left me-2"></i>Keep Registration
                                        </button>
                                        <form method="post" action="{{ path('app_cancel_session', {id: session.id}) }}" class="d-inline">
                                            <input type="hidden" name="_token" value="{{ csrf_token('cancel-session-' ~ session.id) }}">
                                            <button type="submit" class="btn btn-danger px-4">
                                                <i class="bi bi-trash me-2"></i>Yes, Cancel It
                                            </button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                {% else %}
                    <div class="col-lg-8">
                        <div class="empty-state-card text-center p-5">
                            <div class="icon-box mb-4">
                                <i class="bi bi-calendar-x"></i>
                            </div>
                            <h3 class="text-white">No Sessions Yet</h3>
                            <p class="text-muted mb-4">You haven't joined any training sessions yet.</p>
                            <a href="{{ path('app_planning_index') }}" class="btn-primary-custom">
                                <i class="bi bi-search me-2"></i>Browse Sessions
                            </a>
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>
    </section>

    <style>
        .session-card {
            background: #1e293b;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            border: 1px solid rgba(255,255,255,0.05);
            transition: all 0.3s ease;
        }

        .session-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.4);
            border-color: rgba(99, 102, 241, 0.3);
        }

        .session-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            min-height: 250px;
        }

        .session-content {
            padding: 1.5rem;
        }

        .badge-type {
            background: rgba(99, 102, 241, 0.2);
            color: #818cf8;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border: 1px solid rgba(99, 102, 241, 0.3);
        }

        .badge-status {
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 700;
        }

        .badge-status.pending {
            background: rgba(251, 191, 36, 0.2);
            color: #fbbf24;
            border: 1px solid rgba(251, 191, 36, 0.3);
        }

        .badge-status.confirmed {
            background: rgba(34, 197, 94, 0.2);
            color: #4ade80;
            border: 1px solid rgba(34, 197, 94, 0.3);
        }

        .badge-status.cancelled {
            background: rgba(239, 68, 68, 0.2);
            color: #f87171;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .session-title {
            color: #f8fafc;
            font-weight: 700;
            font-size: 1.3rem;
            margin: 1rem 0;
            line-height: 1.3;
        }

        .session-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.75rem;
            margin: 1rem 0;
        }

        .detail-item {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #cbd5e1;
            font-size: 0.9rem;
        }

        .detail-item i {
            color: #6366f1;
            font-size: 1rem;
        }

        .session-meta {
            margin: 1rem 0;
            padding-top: 1rem;
            border-top: 1px solid rgba(255,255,255,0.1);
        }

        .session-actions {
            margin-top: 1rem;
        }

        .btn-cancel-session {
            background: rgba(239, 68, 68, 0.1);
            color: #f87171;
            border: 1px solid rgba(239, 68, 68, 0.3);
            padding: 10px 24px;
            border-radius: 10px;
            font-weight: 600;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .btn-cancel-session:hover {
            background: rgba(239, 68, 68, 0.2);
            border-color: rgba(239, 68, 68, 0.5);
            transform: translateY(-2px);
        }

        .empty-state-card {
            background: #1e293b;
            border-radius: 20px;
            border: 1px solid rgba(255,255,255,0.05);
        }

        .icon-box i {
            font-size: 64px;
            color: rgba(255,255,255,0.1);
        }

        .btn-primary-custom {
            background: linear-gradient(45deg, #6366f1, #4f46e5);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 50px;
            font-weight: 600;
            text-decoration: none;
            display: inline-block;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(99, 102, 241, 0.3);
        }

        .btn-primary-custom:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(99, 102, 241, 0.5);
            color: white;
        }
    </style>
{% endblock %}
